// Add these models to your schema.prisma file

model SupportConversation {
  id              String            @id @default(cuid()) @map("_id")
  userId          String            // User who started the conversation
  userRole        String            // STUDENT, LECTURER, ADMIN
  status          ConversationStatus @default(ACTIVE)
  title           String?           // Auto-generated from first message
  escalated       Boolean           @default(false)
  escalatedTo     String?           // Admin ID if escalated
  escalatedAt     DateTime?
  resolvedAt      DateTime?
  satisfactionRating Int?           // 1-5 rating after resolution
  satisfactionFeedback String?
  metadata        Json?             // Additional data
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  user        User            @relation("SupportConversationUser", fields: [userId], references: [id], onDelete: Cascade)
  messages    SupportMessage[]
  escalatedBy User?           @relation("SupportConversationEscalated", fields: [escalatedTo], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("support_conversations")
}

model SupportMessage {
  id              String          @id @default(cuid()) @map("_id")
  conversationId  String
  sender          MessageSender   // USER, AI, ADMIN
  content         String
  isAI           Boolean         @default(false)
  aiModel         String?         // e.g., "gpt-3.5-turbo", "claude-3"
  aiTokensUsed   Int?            // Tokens consumed for AI response
  metadata       Json?           // Additional data (error info, etc.)
  createdAt       DateTime        @default(now())

  conversation SupportConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId, createdAt])
  @@map("support_messages")
}

enum ConversationStatus {
  ACTIVE
  RESOLVED
  ESCALATED
  ARCHIVED
}

enum MessageSender {
  USER
  AI
  ADMIN
}

